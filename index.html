<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Curefly Global - Find World-Class Healthcare</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { box-sizing: border-box; }
    .hospital-card { transition: transform 0.2s, box-shadow 0.2s; }
    .hospital-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    .star-rating { color: #fbbf24; }
  </style>

  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
</head>

<body class="h-full bg-gradient-to-br from-blue-50 to-white font-sans">
<div class="min-h-full">
  
<!-- HEADER (unchanged) -->
... *(YOUR FULL HEADER SECTION — UNCHANGED)* ...

<!-- EVERYTHING ABOVE IS IDENTICAL — I DID NOT CHANGE ANYTHING -->

<!-- ⭐ BEGIN LOGIC CHANGE HERE ⭐ -->
<script>
let hospitalData = {};   // dynamic

// Load JSON from GitHub Pages
async function loadHospitalJSON() {
    try {
        const response = await fetch("./nabh_google_enriched.json");
        const data = await response.json();

        // Convert into your structure (group by city)
        const grouped = {};

        data.forEach(h => {
            const city = (h.city || "unknown").toLowerCase().trim();
            if (!grouped[city]) grouped[city] = [];
            grouped[city].push(h);
        });

        hospitalData = grouped;
        console.log("Loaded Google-enriched NABH data:", hospitalData);

        populateCities();

    } catch (err) {
        console.error("JSON Load Error:", err);
    }
}

// Populate dropdown dynamically
function populateCities() {
    const cities = Object.keys(hospitalData);
    const select = document.getElementById("city-select");

    select.innerHTML = `<option value="">Choose a city...</option>`;

    cities.forEach(city => {
        const opt = document.createElement("option");
        opt.value = city;
        opt.textContent = city.charAt(0).toUpperCase() + city.slice(1);
        select.appendChild(opt);
    });

    // Always include kolkata even if no hospitals yet
    if (!cities.includes("kolkata")) {
        const opt = document.createElement("option");
        opt.value = "kolkata";
        opt.textContent = "Kolkata";
        select.appendChild(opt);
    }
}

// SEARCH SYSTEM — SAME DESIGN
const citySelect = document.getElementById("city-select");
const specialtySelect = document.getElementById("specialty-select");
const searchBtn = document.getElementById("search-btn");
const resultsSection = document.getElementById("results-section");
const hospitalsGrid = document.getElementById("hospitals-grid");
const resultsCount = document.getElementById("results-count");
const noResults = document.getElementById("no-results");
const hospitalModal = document.getElementById("hospital-modal");
const closeModal = document.getElementById("close-modal");

searchBtn.addEventListener("click", performSearch);
citySelect.addEventListener("change", performSearch);
specialtySelect.addEventListener("change", performSearch);

function performSearch() {
    const city = citySelect.value;
    const specialty = specialtySelect.value.toLowerCase();

    if (!city || !hospitalData[city]) {
        showNoResults();
        return;
    }

    let list = hospitalData[city];

    if (specialty) {
        list = list.filter(h =>
            (h.specialties || [])
              .some(s => s.toLowerCase().includes(specialty))
        );
    }

    if (!list.length) showNoResults();
    else displayResults(list);
}

function showNoResults() {
    resultsSection.classList.add("hidden");
    noResults.classList.remove("hidden");
}

function displayResults(hospitals) {
    noResults.classList.add("hidden");
    resultsSection.classList.remove("hidden");
    resultsCount.textContent = `${hospitals.length} hospital(s) found`;

    hospitalsGrid.innerHTML = hospitals.map(h => `
        <div class="hospital-card bg-white rounded-lg shadow-md p-6 cursor-pointer" onclick="showHospitalDetails('${h.id}')">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">${h.name}</h3>
                    <span class="bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded-full">
                        NABH Accredited
                    </span>
                </div>
                <div class="text-right">
                    <div class="flex items-center">
                        <span class="star-rating text-lg">★</span>
                        <span class="ml-1 font-semibold">${h.rating || "—"}</span>
                    </div>
                    <p class="text-sm text-gray-600">${h.reviews || 0} reviews</p>
                </div>
            </div>

            <p class="text-gray-600 mb-2">${h.address || ""}</p>
            <p class="text-blue-600 font-medium">${h.phone || ""}</p>

            <h4 class="font-semibold text-gray-900 mt-4 mb-2">Specialties:</h4>
            <div class="flex flex-wrap gap-2">
                ${(h.specialties || []).map(s =>
                    `<span class="bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full">${s}</span>`
                ).join("")}
            </div>

            <div class="border-t pt-4 mt-4">
                <p class="text-sm text-gray-600 mb-2">
                    <strong>Nearest Airport:</strong> ${h.nearestAirport || ""}
                </p>
                <button class="text-blue-600 hover:text-blue-800 font-medium text-sm">
                    View Details & Navigation →
                </button>
            </div>
        </div>
    `).join("");
}

// MODAL – SAME DESIGN
function showHospitalDetails(id) {
    const hospital = Object.values(hospitalData).flat().find(h => h.id == id);
    if (!hospital) return;

    document.getElementById("modal-hospital-name").textContent = hospital.name;

    document.getElementById("modal-content").innerHTML = `
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
                <h3 class="text-lg font-semibold mb-3">Hospital Information</h3>
                <p><strong>Address:</strong> ${hospital.address || ""}</p>
                <p><strong>Phone:</strong> ${hospital.phone || ""}</p>
                <p><strong>Website:</strong>
                    <a href="${hospital.website || "#"}" target="_blank" class="text-blue-600 hover:text-blue-800">
                        ${hospital.website || "Not available"}
                    </a>
                </p>
                <p><strong>Rating:</strong> ★ ${hospital.rating || "—"}
                   (${hospital.reviews || 0} reviews)</p>
                <p><strong>NABH Accredited:</strong>
                   <span class="text-green-600">✓ Yes</span></p>
            </div>

            <div>
                <h3 class="text-lg font-semibold mb-3">Airport Navigation</h3>
                <div class="bg-green-50 p-4 rounded-lg">
                    <p><strong>Nearest Airport:</strong> ${hospital.nearestAirport || ""}</p>
                    <p>${hospital.navigation || ""}</p>

                    <button class="mt-3 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm"
                        onclick="openGoogleMaps('${hospital.address}')">
                        Open in Google Maps
                    </button>
                </div>
            </div>
        </div>
    `;

    hospitalModal.classList.remove("hidden");
}

function openGoogleMaps(addr) {
    window.open(`https://www.google.com/maps/search/${encodeURIComponent(addr)}`, "_blank");
}

closeModal.onclick = () => hospitalModal.classList.add("hidden");
hospitalModal.onclick = (e) => { if (e.target === hospitalModal) hospitalModal.classList.add("hidden"); };

// LOAD JSON ON PAGE READY
loadHospitalJSON();
</script>
<!-- ⭐ END OF CUSTOM LOGIC ⭐ -->

<!-- YOUR ELEMENT SDK + OTHER SCRIPT BLOCKS REMAIN UNCHANGED BELOW -->
... (keep all your Element SDK scripts untouched) ...

</body>
</html>
