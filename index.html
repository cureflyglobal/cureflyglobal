<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Curefly Global - Find World-Class Healthcare</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .hospital-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .hospital-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .star-rating {
            color: #fbbf24;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-blue-50 to-white font-sans">
  <div class="min-h-full"><!-- Header -->
   <header class="bg-white shadow-lg border-b-4 border-blue-600">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
     <div class="flex flex-col md:flex-row justify-between items-center">
      <div class="mb-4 md:mb-0">
       <h1 id="site-title" class="text-3xl font-bold text-blue-900">Curefly Global</h1>
       <p id="tagline" class="text-lg text-blue-700 mt-1">Find World-Class Healthcare</p>
      </div>
      <div class="flex flex-col sm:flex-row gap-4">
       <div class="text-center">
        <p class="text-sm text-gray-600">Local Helpdesk</p>
        <p id="local-helpdesk" class="text-lg font-semibold text-blue-900">+91-11-4567-8900</p>
       </div>
       <div class="text-center">
        <p class="text-sm text-gray-600">International Helpdesk</p>
        <p id="international-helpdesk" class="text-lg font-semibold text-green-700">+1-800-123-4567</p>
       </div>
      </div>
     </div>
    </div>
   </header><!-- Search Section -->
   <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
     <h2 class="text-2xl font-bold text-gray-900 mb-6">Search NABH Accredited Hospitals</h2>
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div><label for="city-select" class="block text-sm font-medium text-gray-700 mb-2">Select City</label> <select id="city-select" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"> <option value="">Choose a city...</option> </select>
      </div>
      <div><label for="specialty-select" class="block text-sm font-medium text-gray-700 mb-2">Specialty (Optional)</label> <select id="specialty-select" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"> <option value="">All Specialties</option> <option value="cardiology">Cardiology</option> <option value="orthopedics">Orthopedics</option> <option value="oncology">Oncology</option> <option value="neurology">Neurology</option> <option value="gastroenterology">Gastroenterology</option> </select>
      </div>
      <div class="flex items-end"><button id="search-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200"> Search Hospitals </button>
      </div>
     </div>
    </div><!-- Results Section -->
    <div id="results-section" class="hidden">
     <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-bold text-gray-900">Search Results</h3><span id="results-count" class="text-gray-600"></span>
     </div>
     <div id="hospitals-grid" class="grid grid-cols-1 lg:grid-cols-2 gap-6"><!-- Hospital cards will be inserted here -->
     </div>
    </div><!-- No Results Message -->
    <div id="no-results" class="hidden text-center py-12">
     <div class="text-gray-500">
      <svg class="mx-auto h-12 w-12 mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.08-2.33" />
      </svg>
      <h3 class="text-lg font-medium text-gray-900 mb-2">No hospitals found</h3>
      <p class="text-gray-500">Please select a city to view available hospitals.</p>
     </div>
    </div>
   </main><!-- Features Overview Section (kept as-is) -->
   <section class="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="text-center mb-12">
      <h2 class="text-4xl font-bold mb-4">What You'll Find on Our Platform</h2>
      <p class="text-xl text-blue-100">Comprehensive medical tourism services for international patients</p>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      <div class="text-center">
       <div class="bg-white bg-opacity-20 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8" fill="currentColor" viewbox="0 0 20 20"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
       </div>
       <h3 class="text-lg font-semibold mb-2">NABH Verified Hospitals</h3>
       <p class="text-blue-100 text-sm">Only accredited hospitals with international quality standards</p>
      </div>
      <div class="text-center">
       <div class="bg-white bg-opacity-20 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8" fill="currentColor" viewbox="0 0 20 20"><path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z" />
        </svg>
       </div>
       <h3 class="text-lg font-semibold mb-2">Expert Doctors</h3>
       <p class="text-blue-100 text-sm">Detailed profiles with patient reviews and success rates</p>
      </div>
      <div class="text-center">
       <div class="bg-white bg-opacity-20 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8" fill="currentColor" viewbox="0 0 20 20"><path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z" />
        </svg>
       </div>
       <h3 class="text-lg font-semibold mb-2">Transparent Pricing</h3>
       <p class="text-blue-100 text-sm">Clear surgery costs with no hidden fees</p>
      </div>
      <div class="text-center">
       <div class="bg-white bg-opacity-20 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8" fill="currentColor" viewbox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
        </svg>
       </div>
       <h3 class="text-lg font-semibold mb-2">Travel Assistance</h3>
       <p class="text-blue-100 text-sm">Airport navigation and local support services</p>
      </div>
     </div>
    </div>
   </section><!-- rest of page left intact to preserve Canva design -->
  </div>

  <!-- Hospital Detail Modal -->
  <div id="hospital-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
   <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90%] overflow-y-auto">
    <div class="p-6">
     <div class="flex justify-between items-start mb-4">
      <h2 id="modal-hospital-name" class="text-2xl font-bold text-gray-900"></h2><button id="close-modal" class="text-gray-400 hover:text-gray-600" aria-label="Close modal">
       <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
       </svg></button>
     </div>
     <div id="modal-content"><!-- Modal content will be inserted here --></div>
    </div>
   </div>
  </div>

  <script>
    // DOM refs
    const citySelect = document.getElementById('city-select');
    const specialtySelect = document.getElementById('specialty-select');
    const searchBtn = document.getElementById('search-btn');
    const resultsSection = document.getElementById('results-section');
    const hospitalsGrid = document.getElementById('hospitals-grid');
    const resultsCount = document.getElementById('results-count');
    const noResults = document.getElementById('no-results');
    const hospitalModal = document.getElementById('hospital-modal');
    const closeModal = document.getElementById('close-modal');
    const modalContent = document.getElementById('modal-content');
    const modalTitle = document.getElementById('modal-hospital-name');

    // hospitalData mapping by cityKey; will be populated from nabh_google_enriched.json
    let hospitalData = {};

    // helper normalizer
    function normalizeKey(s){ return (s||'').toString().trim().toLowerCase(); }

    // load JSON file (expects /nabh_google_enriched.json at site root)
    async function loadEnrichedJson() {
      try {
        const res = await fetch('/nabh_google_enriched.json', {cache: "no-store"});
        if (!res.ok) {
          console.warn('Could not fetch /nabh_google_enriched.json — status', res.status);
          return [];
        }
        const data = await res.json();
        if (!Array.isArray(data)) return [];
        return data;
      } catch (err) {
        console.error('Error loading enriched JSON:', err);
        return [];
      }
    }

    function buildHospitalDataFromEnriched(list) {
      const map = {};
      list.forEach((h, idx) => {
        const cityKey = normalizeKey(h.city || h.address || h.source_record?.city || 'unknown');
        if (!map[cityKey]) map[cityKey] = [];
        // create canonical record preserving Google-enriched fields
        const rec = {
          id: h.place_id || ('g-' + idx + '-' + Date.now().toString().slice(-5)),
          name: h.name || h.hospital_name || 'Unnamed Hospital',
          nabh: !!h.google_found || !!h.nabh,
          rating: h.rating || null,
          reviews: h.reviews || null,
          specialties: h.specialties || (h.source_record?.specialties || []),
          address: h.address || '',
          phone: h.phone || '',
          website: h.website || '',
          doctors: h.doctors || (h.source_record?.doctors || []),
          surgeries: h.surgeries || h.surgeryPackages || h.source_record?.surgeryPackages || [],
          nearestAirport: h.nearest_airport || h.nearestAirport || '',
          navigation: h.navigation_url || h.navigation || h.navigation_url || '',
          lat: h.lat || null,
          lng: h.lng || null,
          place_id: h.place_id || null,
          source_record: h.source_record || null
        };
        map[cityKey].push(rec);
      });
      return map;
    }

    function populateCitySelectFromData() {
      // remove existing dynamic options first (keep placeholder)
      const existingVals = new Set(Array.from(citySelect.options).map(o => normalizeKey(o.value||o.textContent)));
      Object.keys(hospitalData).forEach(k => {
        if (!existingVals.has(k)) {
          const opt = document.createElement('option');
          opt.value = k;
          opt.textContent = k.split(' ').map(w => w.charAt(0).toUpperCase()+w.slice(1)).join(' ');
          citySelect.appendChild(opt);
        }
      });
      // ensure kolkata present
      if (!Array.from(citySelect.options).some(o=>normalizeKey(o.value)==='kolkata')) {
        const opt = document.createElement('option'); opt.value='kolkata'; opt.textContent='Kolkata'; citySelect.appendChild(opt);
        if (!hospitalData['kolkata']) hospitalData['kolkata'] = [];
      }
    }

    function renderHospitalCards(list) {
      hospitalsGrid.innerHTML = list.map(hospital => {
        const specialtiesHtml = (hospital.specialties || []).map(s => `<span class="bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full">${s}</span>`).join(' ');
        const ratingHtml = hospital.rating ? `<div class="flex items-center"><span class="star-rating text-lg">★</span><span class="ml-1 font-semibold">${hospital.rating}</span></div>` : '';
        const reviews = hospital.reviews ? `<p class="text-sm text-gray-600">${hospital.reviews} reviews</p>` : '';
        const phone = hospital.phone ? `<p class="text-blue-600 font-medium">${hospital.phone}</p>` : '';
        const address = hospital.address ? `<p class="text-gray-600 mb-2">${hospital.address}</p>` : '';
        const nearestAirport = hospital.nearestAirport ? `<p class="text-sm text-gray-600 mb-2"><strong>Nearest Airport:</strong> ${hospital.nearestAirport}</p>` : '';
        return `
          <div class="hospital-card bg-white rounded-lg shadow-md p-6 cursor-pointer" data-id="${hospital.id}">
            <div class="flex justify-between items-start mb-4">
              <div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">${hospital.name}</h3>
                <div class="flex items-center mb-2">
                  <span class="bg-green-100 text-green-800 text-xs font-semibold px-2 py-1 rounded-full">NABH Accredited</span>
                </div>
              </div>
              <div class="text-right">
                ${ratingHtml}
                ${reviews}
              </div>
            </div>

            <div class="mb-4">
              ${address}
              ${phone}
            </div>

            <div class="mb-4">
              <h4 class="font-semibold text-gray-900 mb-2">Specialties:</h4>
              <div class="flex flex-wrap gap-2">${specialtiesHtml}</div>
            </div>

            <div class="border-t pt-4">
              ${nearestAirport}
              <button class="text-blue-600 hover:text-blue-800 font-medium text-sm view-details-btn">View Details & Navigation →</button>
            </div>
          </div>
        `;
      }).join('');
      // attach handlers
      attachCardHandlers();
    }

    function showNoResults() {
      resultsSection.classList.add('hidden');
      noResults.classList.remove('hidden');
    }
    function showResults(list) {
      noResults.classList.add('hidden');
      resultsSection.classList.remove('hidden');
      resultsCount.textContent = `${list.length} hospital(s) found`;
      renderHospitalCards(list);
    }

    function performSearch() {
      const selectedCity = normalizeKey(citySelect.value);
      const selectedSpecialty = (specialtySelect.value || '').toLowerCase();

      if (!selectedCity) { showNoResults(); return; }
      const hospitals = (hospitalData[selectedCity] || []).slice();
      if (!hospitals || hospitals.length===0) { showNoResults(); return; }

      let filtered = hospitals;
      if (selectedSpecialty) {
        filtered = hospitals.filter(h => (h.specialties || []).some(s => s.toLowerCase().includes(selectedSpecialty)));
      }
      if (!filtered.length) showNoResults(); else showResults(filtered);
    }

    function attachCardHandlers() {
      hospitalsGrid.querySelectorAll('.hospital-card').forEach(card => {
        const btn = card.querySelector('.view-details-btn');
        const id = card.getAttribute('data-id');
        card.onclick = () => showHospitalDetails(id);
        btn?.addEventListener('click', (ev)=>{ ev.stopPropagation(); showHospitalDetails(id); });
      });
    }

    function showHospitalDetails(id) {
      const hospital = Object.values(hospitalData).flat().find(h => h.id === id);
      if (!hospital) return;
      modalTitle.textContent = hospital.name || 'Hospital Details';
      const websiteHtml = hospital.website ? `<p><strong>Website:</strong> <a href="${hospital.website}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800">${hospital.website}</a></p>` : '';
      const ratingHtml = hospital.rating ? `<p><strong>Rating:</strong> ★ ${hospital.rating} (${hospital.reviews||0} reviews)</p>` : '';
      const doctorsHtml = (hospital.doctors || []).map(d => `
        <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-blue-500 mb-3">
          <div class="flex justify-between items-start mb-2">
            <div>
              <p class="font-semibold text-lg">${d.name || 'Dr. —'}</p>
              <p class="text-blue-600 font-medium">${d.specialty || ''}</p>
            </div>
            <div class="text-right">
              ${d.rating?`<div class="flex items-center"><span class="star-rating text-lg">★</span><span class="ml-1 font-semibold">${d.rating}</span></div>`:''}
              ${d.reviews?`<p class="text-sm text-gray-600">${d.reviews} reviews</p>`:''}
            </div>
          </div>
          <p class="text-sm text-gray-700 mb-2">${d.qualifications||''}</p>
          <div class="flex justify-between items-center text-sm">
            <span class="text-gray-600">${d.experience||''} experience</span>
            ${d.consultationFee?`<span class="text-green-600 font-medium">Consultation: ${d.consultationFee}</span>`:''}
          </div>
          ${d.languages?`<p class="text-xs text-gray-500 mt-1">Languages: ${d.languages.join(', ')}</p>`:''}
        </div>
      `).join('') || '<p class="text-gray-600">Doctor details not provided.</p>';

      modalContent.innerHTML = `
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-semibold mb-3">Hospital Information</h3>
            <div class="space-y-2 mb-6">
              <p><strong>Address:</strong> ${hospital.address||''}</p>
              <p><strong>Phone:</strong> ${hospital.phone||''}</p>
              ${websiteHtml}
              ${ratingHtml}
              <p><strong>NABH Accredited:</strong> <span class="text-green-600">✓ Yes</span></p>
            </div>

            <h3 class="text-lg font-semibold mb-3">All Specialist Doctors</h3>
            <div class="space-y-4 mb-6">${doctorsHtml}</div>
          </div>

          <div>
            <h3 class="text-lg font-semibold mb-3">Popular Surgery Costs</h3>
            <div class="space-y-3 mb-6">
              ${(hospital.surgeries||[]).map(s=>`<div class="bg-blue-50 p-3 rounded-lg"><p class="font-medium">${s.name||s.title||'Procedure'}</p><p class="text-blue-600 font-semibold">${s.cost||s.price||''}</p></div>`).join('')||'<p class="text-gray-600">Surgery price details not provided.</p>'}
            </div>

            <h3 class="text-lg font-semibold mb-3">Airport Navigation</h3>
            <div class="bg-green-50 p-4 rounded-lg">
              <p class="font-medium mb-2">From ${hospital.nearestAirport||'—'}</p>
              <p class="text-sm text-gray-700">${hospital.navigation||'Navigation details not provided.'}</p>
              ${hospital.lat && hospital.lng ? `<button class="mt-3 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm" onclick="window.open('https://www.google.com/maps/dir/?api=1&destination=${hospital.lat},${hospital.lng}','_blank')">Open in Google Maps</button>` : hospital.address ? `<button class="mt-3 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm" onclick="window.open('https://www.google.com/maps/search/${encodeURIComponent(hospital.address)}','_blank')">Open in Google Maps</button>` : ''}
            </div>
          </div>
        </div>
      `;
      hospitalModal.classList.remove('hidden');
    }

    closeModal?.addEventListener('click', ()=> hospitalModal.classList.add('hidden'));
    hospitalModal?.addEventListener('click', (e)=> { if (e.target===hospitalModal) hospitalModal.classList.add('hidden'); });

    // wire UI
    searchBtn?.addEventListener('click', ()=> { performSearch(); });
    citySelect?.addEventListener('change', ()=> { performSearch(); });
    specialtySelect?.addEventListener('change', ()=> { performSearch(); });

    // Initialize: load JSON and build data
    (async function init(){
      const enriched = await loadEnrichedJson();
      if (!enriched || !enriched.length) {
        console.warn('No enriched JSON found or file empty. Place nabh_google_enriched.json in site root.');
        // still add kolkata option
        const opt = document.createElement('option'); opt.value='kolkata'; opt.textContent='Kolkata'; citySelect.appendChild(opt);
        showNoResults();
        return;
      }
      hospitalData = buildHospitalDataFromEnriched(enriched);
      populateCitySelectFromData();
      console.info('Loaded enriched hospitals:', Object.keys(hospitalData).reduce((a,k)=> a + hospitalData[k].length,0));
    })();
  </script>

  <!-- Keep Cloudflare snippet if present on your original site -->
  <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99f7740f013d3b33',t:'MTc2MzMwMDk4NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>

</body>
</html>
